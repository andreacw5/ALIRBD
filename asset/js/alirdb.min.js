/*
*
*                                 MIT License
*
*    Copyright (c) 2017 Andrea Zago
*
*    Permission is hereby granted, free of charge, to any person obtaining a copy
*    of this software and associated documentation files (the "Software"), to deal
*    in the Software without restriction, including without limitation the rights
*    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
*    copies of the Software, and to permit persons to whom the Software is
*    furnished to do so, subject to the following conditions:
*
*    The above copyright notice and this permission notice shall be included in all
*    copies or substantial portions of the Software.
*
*    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
*    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
*    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
*    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
*    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
*    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
*    SOFTWARE.
*
*/
function statisticOnLoad(){$.ajax({url:playerDatabase,type:"GET",dataType:"json",timeout:5e3}).done(function(e){$("#playerCounter").html(e.length)}),$.ajax({url:gangDatabase,type:"GET",dataType:"json",timeout:5e3}).done(function(e){$("#gangCounter").html(e.length)}),$.ajax({url:vehicleDatabase,type:"GET",dataType:"json",timeout:5e3}).done(function(e){$("#vehicleCounter").html(e.length)}),$.ajax({url:wantedDatabase,type:"GET",dataType:"json",timeout:5e3}).done(function(e){$("#wantedCounter").html(e.length)}),$("#adminCounter").html("11")}function goToHome(){hideOpenWindow(),$("#mainsearchpage").removeAttr("hidden"),$("#listUserAppendElement, #appendgangmembers, #uservehicleappender, #listGangAppendElement, #appendFactionsMembers").empty(),console.clear()}function hideOpenWindow(){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #noresult, #viewfactionlist, #errorServer").attr("hidden",!0)}function hideAllInfoPanel(){$("#userinfopanel, #userlicensepanel, #uservehiclepanel, #userwantedpanel").hide().attr("hidden",!0)}function showUserInfo(){hideAllInfoPanel(),$("#userinfopanel").show(300).removeAttr("hidden"),$("#infonav").addClass("active"),$("#licensenav, #groupsnav, #vehiclenav, #userwantedpanel").attr("class","nav-item nav-link")}function showUserWanted(){hideAllInfoPanel(),$("#userwantedpanel").show(300).removeAttr("hidden"),$("#infonav").addClass("active"),$("#licensenav, #groupsnav, #vehiclenav, #userinfopanel").attr("class","nav-item nav-link")}function showUserVehicle(){hideAllInfoPanel(),$("#uservehiclepanel").show(300).removeAttr("hidden"),$("#vehiclenav").addClass("active"),$("#infonav, #groupsnav, #licensenav, #userwantedpanel").attr("class","nav-item nav-link")}function searchByPlayer(e){e||(e=$("#searchinput").val()),$("#mainsearchpage").attr("hidden",!0),$.ajax({url:playerDatabase,type:"GET",timeout:5e3,contentType:"json",data:{q:e}}).done(function(e){e.length>1?showUserList(e):1===e.length?($("#playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage, #noresult").attr("hidden",!0),showUser(e)):($("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#noresult").removeAttr("hidden"))}).fail(function(){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#errorServer").removeAttr("hidden"),$("#modulename").html("player")})}function showUserList(e){$("#playermultyresult").removeAttr("hidden");var a;e.length>searchLimiter?(a=searchLimiter,$("#resultsize").html(searchLimiter)):(a=e.length,$("#resultsize").html(e.length));for(var t=0;t<a;t++){var r=e[t].name,s=e[t].playerid,i=e[t].aliases,l=$('<a style="cursor:pointer;" id="'+s+'" data-id="'+s+'" class="list-group-item list-group-item-action flex-column align-items-start">    <div class="d-flex w-100 justify-content-between">      <h5 class="mb-1">'+r+'</h5>      <small><i class="fas fa-external-link-alt"></i></small>    </div>    <small>Playerid: '+s+" - Alias: "+i+"</small>  </a>");$("#listUserAppendElement").append(l)}for(var n=0;n<a;n++){var o=e[n].playerid;$("#"+o).on("click",function(){searchByPlayer($(this).data("id"))})}}function showUser(e){$("#playersearchview").removeAttr("hidden"),showUserInfo(),$("#usernameplace").html(e[0].name),$("#playeridplace").html(e[0].playerid),$("#userbankacc").html(e[0].bankacc),$("#usercash").html(e[0].cash),$("#useralias").html(e[0].aliases);var a="http://steamcommunity.com/profiles/"+e[0].playerid+"/";$("#steamLink").attr("href",a);var t;switch(e[0].donorlevel){case"1":t=$('<i class="fa fa-star"></i>');break;case"2":t=$('<i class="fa fa-star"></i><i class="fa fa-star"></i>');break;case"3":t=$('<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>');break;case"4":t=$('<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>');break;case"5":t=$('<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>');break;case"6":t=$('<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>');break;default:t=" Nessuno"}$("#userdonorlevel").html(t);var r;switch(e[0].coplevel){case"1":r=" Agente - Livello 1";break;case"2":r=" Agente Scelto - Livello 2";break;case"3":r=" Assistente - Livello 3";break;case"4":r=" Assistente Capo - Livello 4";break;case"5":r=" Sovrintendente - Livello 5";break;case"6":r=" Sovrintendente Capo - Livello 6";break;case"7":r=" Ispettore - Livello 7";break;case"8":r=" Ispettore Capo - Livello 8";break;case"9":r=" Commissario - Livello 9";break;case"10":r=" Questore - Livello 10";break;default:r=" Non è un'agente!"}$("#usercoplevel").html(r);var s;switch(e[0].mediclevel){case"1":s=" Medico - Livello 1";break;case"2":s=" Medico - Livello 2";break;case"3":s=" Medico - Livello 3";break;case"4":s=" Medico - Livello 4";break;case"5":s=" Medico - Livello 5";break;default:s=" Non è un medico!"}$("#usermedlevel").html(s),getGangName(e[0].playerid),getUserVehicle(e[0].playerid)}function getUserVehicle(e){$.ajax({url:vehicleDatabase,type:"GET",timeout:5e3,contentType:"json",data:{q:e}}).done(function(e){if(e.length>0){$("#vehiclesize").html("Possiede "+e.length+" veicoli:");for(var a=0;a<e.length;a++){var t,r,s=e[a].side,i=e[a].plate,l=e[a].color;switch(e[a].classname){case"B_Quadbike_01_F":t="Quad";break;case"C_Offroad_01_F":t="Offroad";break;case"C_Offroad_01_repair_F":t="Offroad (Ripara)";break;case"C_Offroad_02_unarmed_F":case"O_G_Offroad_01_F":t="Offroad (Mimetico)";break;case"C_SUV_01_F":t="Suv";break;case"C_Hatchback_01_F":t="Hatchback";break;case"C_Hatchback_01_sport_F":t="Hatchback (Sport)";break;case"O_MRAP_02_F":t="Ifrit";break;case"B_MRAP_01_F":t="Hunter";break;case"O_T_LSV_02_unarmed_black_F":t="Quilin (Nero)";break;case"B_LSV_01_unarmed_black_F":t="Prowler (Nero)";break;case"I_G_Van_01_transport_F":t="Furgone (Cassone)";break;case"O_Truck_02_transport_F":t="Zamak (Trasporto)";break;case"O_Truck_02_covered_F":case"I_Truck_02_covered_F":t="Zamak (Telonato)";break;case"O_Truck_02_fuel_F":t="Zamak (Carburante)";break;case"B_Truck_01_transport_F":t="HEMTT (Trasporto)";break;case"B_Truck_01_covered_F":t="HEMTT (Telonato)";break;case"B_Truck_01_box_F":t="HEMTT (Cassone)";break;case"B_Truck_01_fuel_F":t="HEMTT (Carburante)";break;case"B_Truck_01_mover_F":t="HEMTT (Solo cabina)";break;case"C_Van_01_box_F":t="Furgone (Cassone)";break;case"C_Van_01_fuel_F":t="Furgone (Carburante)";break;case"O_T_Truck_03_covered_ghex_F":t="Tempest Apex (Telonato)";break;case"O_Truck_03_transport_F":t="Tempest (Trasporto)";break;case"O_Truck_03_fuel_F":t="Tempest (Carburante)";break;case"O_Truck_03_covered_F":t="Tempest (Telonato)";break;case"C_Kart_01_Fuel_F":t="Kart";break;case"C_Van_02_transport_F":t="Camioncino (Trasporto)";break;case"C_Van_02_vehicle_F":t="Camioncino (Cargo)";break;case"C_Van_02_medevac_F":t="Ambulanza";break;case"C_Heli_Light_01_civil_F":t="MH-900";break;case"B_Heli_Light_01_F":t="Hummingbird";break;case"B_Heli_Transport_01_F":t="Ghosthawk";break;case"O_Heli_Transport_04_F":t="Mi-290 Taru";break;case"O_Heli_Transport_04_medevac_F":t="Mi-290 Taru (Medico) ";break;case"B_Heli_Transport_03_unarmed_F":t="Huron";break;case"B_Heli_Light_01_stripped_F":t="Hummingbird (Ricettato)";break;case"O_Heli_Light_02_unarmed_F":t="PO-30 Orca (Disarmata)";break;case"I_Heli_Transport_02_F":t="AW101 Mohawk (Merlin)";break;case"I_Heli_light_03_unarmed_F":t="WY-55 Hellcat";break;case"B_T_VTOL_01_infantry_F":t="V-44 X Blackfish (Fanteria)";break;case"B_T_VTOL_01_vehicle_F":t="V-44 X Blackfish (Veicoli)";break;case"B_T_VTOL_01_armed_F":t="V-44 X Blackfish (Armato)";break;case"C_Plane_Civil_01_racing_F":t="Caesar BTT (Corsa)";break;case"C_Rubberboat":case"B_Boat_Transport_01_F":t="Gommone";break;case"O_Lifeboat":t="Gommone da salvataggio";break;case"O_T_Boat_Transport_01_F":t="Gommone";break;case"B_Boat_Armed_01_minigun_F":t="Barca armata (Minigun)";break;case"C_Boat_Civil_01_F":t="Motoscafo";break;case"C_Boat_Civil_01_police_F":t="Motoscafo (Polizia)";break;case"C_Boat_Civil_01_rescue_F":t="Motoscafo (Soccorso)";break;case"B_SDV_01_F":case"O_SDV_01_F":t="Sommergibile (SDV)";break;case"C_Scooter_Transport_01_F":t="Moto d'acqua";break;default:t=e[a].classname}var n,o;"cop"===s?(n="#4286f4",o="Veicolo della polizia"):"med"===s?(n="#d8a011",o="Veicolo medico"):(n="#ffffff",o="Veicolo civile"),r="Car"===e[a].type?'<i class="fas fa-car" style="color: '+n+';"></i>':"Air"===e[a].type?'<i class="fas fa-plane" style="color: '+n+';"></i>':'<i class="fas fa-ship" style="color: '+n+';"></i>';var c=$('<div class="col-12 padbot">                        <div class="card">                            <div class="card-body">                                <h4 class="card-title">'+r+" "+t+'</h4>                                <h6 class="card-subtitle mb-2 text-muted">'+o+", targato "+i+" (colore "+l+")</h6>                            </div>                        </div>                    </div>");$("#uservehicleappender").append(c)}}else $("#vehiclesize").html("Questo utente non possiede veicoli!")}).fail(function(){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#errorServer").removeAttr("hidden"),$("#modulename").html("vehicle")})}function showFactionList(e){$.ajax({url:playerDatabase,type:"GET",dataType:"json",timeout:5e3}).done(function(a){for(var t,r=1,s=0;s<a.length;s++){var i,l=a[s].coplevel,n=a[s].mediclevel;if("cop"===e?($("#factionName").html("Elenco agenti in servizio"),i=l):"med"===e?($("#factionName").html("Elenco medici in servizio"),i=n):console.log("Type necessario"),"0"!==i&&void 0!==i&&"0"===a[s].adminlevel){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #mainsearchpage, #noresult").attr("hidden",!0),$("#viewfactionlist").removeAttr("hidden"),t=r++;var o,c=new RegExp("[PLK]","gi"),d=a[s].name,m=a[s].playerid;o=1===d.search(c)&&"cop"===e?'<i style="color: #759bc9" title="Polizia Locale" class="fas fa-building"></i>':"cop"===e?'<i style="color: #3D6594" title="Polizia di Stato" class="fas fa-balance-scale"></i>':'<i style="color: #f18e38" title="Medico" class="fas fa-medkit"></i>';var u=$('<tr>    <th scope="row">'+t+"</th>    <td> "+d+'</td>    <td class="statsdiv" style="text-align: center !important;">'+o+'</td>    <td class="statsdiv" style="text-align: center !important;">'+i+'</td>    <td title="Visualizza dettagli utente"  data-toggle="tooltip" id="'+m+'" data-id="'+m+'" data-placement="top" style="color: #007BCC;cursor:pointer;"><i class="fas fa-external-link-alt"></i></td></tr>');$("#appendFactionsMembers").append(u)}}$("#factionCounter").html($("#appendFactionsMembers tr").length);for(var h=0;h<a.length;h++)if("0"!==(i="cop"===e?a[h].coplevel:a[h].mediclevel)&&void 0!==i&&"0"===a[h].adminlevel){var p=a[h].playerid;$("#"+p).on("click",function(){searchByPlayer($(this).data("id"))})}}).fail(function(){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#errorServer").removeAttr("hidden"),$("#modulename").html("player")})}function searchByGang(e){e||(e=$("#searchinput").val()),$("#playersearchview, #playermultyresult, #gangmultyresult, #noresult, #viewfactionlist").attr("hidden",!0),$.ajax({url:gangDatabase,type:"GET",data:{q:e},dataType:"json",timeout:5e3}).done(function(e){e.length>1?($("#mainsearchpage").attr("hidden",!0),showGangList(e)):1===e.length?($("#gangmultyresult").attr("hidden",!0),showGang(e)):($("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#noresult").removeAttr("hidden"))}).fail(function(){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#errorServer").removeAttr("hidden"),$("#modulename").html("gang")})}function showGang(e){$("#appendgangmembers").empty(),$("#mainsearchpage").attr("hidden",!0),$("#gangsearchview").removeAttr("hidden"),$("#gangview").removeAttr("hidden"),$("#singlegangname").html(e[0].name);var a=e[0].members.length;a>20?$("#gangplayernumber").html(a).attr("style","color:red"):a>=17?$("#gangplayernumber").html(a).attr("style","color:yellow"):$("#gangplayernumber").html(a);for(var t=0;t<e[0].members.length;t++){var r=e[0].members[t],s=t+1;getGangMembersName(r,e[0].owner);var i=$('<tr>    <th scope="row">'+s+'</th>    <td id="user'+r+'" ></td>    <td class="statsdiv">'+r+'</td>    <td title="Visualizza dettagli utente"  data-toggle="tooltip" id="'+e[0].members[t]+'" data-id="'+e[0].members[t]+'" data-placement="top" style="color: #007BCC;cursor:pointer;"><i class="fas fa-external-link-alt"></i></td></tr>');$("#appendgangmembers").append(i)}for(var l=0;l<e[0].members.length;l++){var n=e[0].members[l];$("#"+n).on("click",function(){searchByPlayer($(this).data("id"))})}}function getGangMembersName(e,a){$.ajax({url:playerDatabase,type:"GET",data:{q:e},dataType:"json",timeout:5e3}).done(function(t){t[0].name?t[0].playerid===a?$("#user"+e).html(t[0].name+"  (Leader)").css("color","orange").attr("title","Questo utente è il capo della gang"):$("#user"+e).html(t[0].name):$("#gangName"+e).html("Utente non trovato").attr("style","color: red")}).fail(function(){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#errorServer").removeAttr("hidden"),$("#modulename").html("player")})}function getGangName(e){$.ajax({url:gangDatabase,type:"GET",data:{q:e},dataType:"json",timeout:5e3}).done(function(e){1===e.length?$("#usergangname").html(e[0].name).attr("style","color: #007BCC;cursor:pointer;").on("click",function(){searchByGang($(this).html())}):$("#usergangname").html(" Nessuna").removeAttr("style").off("click").attr("title","Questo utente non è in nessuna gang")}).fail(function(){$("#playersearchview, #playermultyresult, #gangsearchview, #gangmultyresult, #viewfactionlist, #mainsearchpage").attr("hidden",!0),$("#errorServer").removeAttr("hidden"),$("#modulename").html("gang")})}function showGangList(e){$("#gangmultyresult").removeAttr("hidden"),$("#gangresultsize").html(e.length);for(var a=0;a<e.length;a++){var t=e[a].name,r=e[a].owner,s=e[a].members.length,i=$('<a style="cursor:pointer;" id="'+r+'" data-id="'+r+'" class="list-group-item list-group-item-action flex-column align-items-start">    <div class="d-flex w-100 justify-content-between">      <h5 class="mb-1">'+t+'</h5>      <small><i class="fas fa-external-link-alt"></i></small>    </div>    <small>Dimensioni: '+s+"/20 - Proprietario: "+r+"</small>  </a>");$("#listGangAppendElement").append(i)}for(var l=0;l<e.length;l++){var n=e[l].owner;$("#"+n).on("click",function(){searchByGang($(this).data("id"))})}}var searchLimiter=100,playerDatabase="https://cors-anywhere.herokuapp.com/http://37.59.102.107:5100/players",gangDatabase="https://cors-anywhere.herokuapp.com/http://37.59.102.107:5200/gangs",vehicleDatabase="https://cors-anywhere.herokuapp.com/http://37.59.102.107:5300/vehicles",wantedDatabase="https://cors-anywhere.herokuapp.com/http://37.59.102.107:5400/wanted",userDatabase="https://cors-anywhere.herokuapp.com/http://37.59.102.107:5500/users";$(function(){$('[data-toggle="tooltip"]').tooltip()}),statisticOnLoad(),$(function(){});